{
  "actions": [
    {
      "id": "get-metadata",
      "description": "GET /metadata",
      "mapping": "doGetMetadata"
    },
    {
      "id": "metadata-http-200",
      "description": "Assert HTTP status=200",
      "mapping": "isMetaDataHttp200"
    },
    {
      "id": "metadata-content-type",
      "description": "Assert Content-Type='application/fhir+json'",
      "mapping": "isMetadataContentTypeOk"
    },
    {
      "id": "capstat-validation-success",
      "description": "Get Validate and Assert CapabilityStatement validation passed successfully",
      "mapping": "isCapstatValidationSuccess"
    },
    {
      "id": "extract-identifiers",
      "description": "Extract resource identifiers from all sampled instances",
      "mapping": "doExtractIdentifiers"
    },
    {
      "id": "extract-gender",
      "description": "Extract Patient.gender value sampled instances",
      "mapping": "doExtractGender"
    },
    {
      "id": "sample-wrapper",
      "description": "Initiate the sampling process",
      "mapping": "doSampleWrapper"
    },
    {
      "id": "doFailSearch",
      "description": "Send an invalid search request and write results to file",
      "mapping": "doFailSearch"
    },
    {
      "id": "isFailedSearchOK",
      "description": "Assert server responds to invalid search request according to spec",
      "mapping": "isFailedSearchOK"
    },
    {
      "id": "doSuccessfulReadResponse",
      "description": "Write to file the HTTP response of a successful read (GET) request for inspection by other maps",
      "mapping": "doSuccessfulReadResponse"
    },
    {
      "id": "isGetContentTypeOK",
      "description": "This map Assert Content-Type='application/fhir+json' on a simple read (GET) response",
      "mapping": "isGetContentTypeOK"
    },
    {
      "id": "isReadId",
      "description": "On simple read (GET), check response resource ID is of correct data-type and matches input ID (Test 87)",
      "mapping": "isReadId"
    },
    {
      "id": "doExtractIds",
      "description": "(Test31) - Check if all sampled instances resource.id comply with FHIR id datatype requirements",
      "mapping": "doExtractIds"
    },
    {
      "id": "doBirthDateDist",
      "description": "(Test 68) - Patient.birthDate disterbution",
      "mapping": "doBirthDateDist"
    }
  ],
  "kits": [
    {
      "id": "data-portability",
      "name": "IL Data Portability Law",
      "description": "This test kit is meant to provide information on the level of conformance to the Israeli regulation regarding health data portability",
      "children": [
        {
          "id": "cap-stat",
          "name": "CapabilityStatement",
          "children": [
            {
              "id": "capstat-exists",
              "name": "Existence",
              "children": [
                {
                  "id": "test11",
                  "name": "Check there is a CapabilityStatement",
                  "description": "Check there is a CapabilityStatement",
                  "details": "Check GET metadata returns a CapabilityStatement.\n Applications SHALL return a resource that describes the functionality of the server end-point.\n https://hl7.org/fhir/R4/http.html#capabilities \n RESTful servers are required to provide this resource on demand. Servers SHALL specify what resource types and operations are supported \n https://hl7.org/fhir/R4/capabilitystatement.html#notes",
                  "actions": [
                    "get-metadata",
                    "metadata-http-200"
                  ]
                }
              ]
            },
            {
              "id": "capstat-validity",
              "name": "Validity",
              "children": [
                {
                  "id": "test173",
                  "name": "CapabilityStatement Content-Type",
                  "description": "IF CapabilityStatement was returned, check Content-Type validity",
                  "details": "The response headers from /metadata must include Content-Type: application/fhir+json",
                  "actions": [
                    "get-metadata",
                    "metadata-content-type"
                  ]
                },
                {
                  "id": "test10",
                  "name": "Base Validation",
                  "description": "IF there is a CapabilityStatement - validate it against the base resource",
                  "details": "https://hl7.org/fhir/R4/capabilitystatement.html",
                  "actions": [
                    "capstat-validation-success"
                  ]
                }
              ]
            }
          ]
        },
        {
          "id": "dqa",
          "name": "Data quality assurance",
          "children": [
            {
              "id": "patient-dist",
              "name": "Patient elements distributions",
              "children": [
                {
                  "id": "test57",
                  "name": "Patient Identifier system distribution",
                  "description": "Patient Identifier system distribution",
                  "details": "Check if the distribution of Patient.identifier.system makes sense.",
                  "actions": [
                    "sample-wrapper",
                    "extract-identifiers"
                  ]
                },
                {
                  "id": "test70",
                  "name": "Patient gender distribution",
                  "description": "Patient gender value distribution",
                  "details": "Check if the distribution of Patient.identifier.system makes sense.",
                  "actions": [
                    "sample-wrapper",
                    "extract-gender"
                  ]
                },
                {
                  "id": "test68",
                  "name": "Patient birthdate distribution",
                  "description": "Patient birthdate value distribution",
                  "details": "Check if the distribution of Patient.birthDate makes sense.",
                  "actions": [
                    "sample-wrapper",
                    "doBirthDateDist"
                  ]
                }
              ]
            },
            {
              "id": "resource-validation",
              "name": "Resource validation",
              "children": [
                {
                  "id": "test31",
                  "name": "Response resource ID is ID (matches ID regex)",
                  "description": "Response resource ID is ID (matches ID regex)",
                  "details": "id\tAny combination of upper- or lower-case ASCII letters ('A'..'Z', and 'a'..'z', numerals ('0'..'9'), '-' and '.', with a length limit of 64 characters. (This might be an integer, an un-prefixed OID, UUID or any other identifier pattern that meets these constraints.)\txs:string\tJSON string\nRegex: [A-Za-z0-9\\-\\.]{1,64}\n\n2.24.0.1 Primitive Types \nhttps://hl7.org/fhir/R4/datatypes.html#primitive",
                  "actions": [
                    "sample-wrapper",
                    "doExtractIds"
                  ]
                }
              ]
            }
          ]
        },
        {
          "id": "search",
          "name": "Search",
          "children": [
            {
              "id": "search-fail",
              "name": "HTTP Status Codes - on Fail",
              "children": [
                {
                  "id": "test114",
                  "name": "Check for error codes and OperationOutcome on failed search",
                  "description": "Check for error codes and OperationOutcome on failed search",
                  "details": "If the search fails (cannot be executed, not that there are no matches), the return value return value SHALL be a status code 4xx or 5xx with an OperationOutcome.",
                  "actions": [
                    "doFailSearch",
                    "isFailedSearchOK"
                  ]
                }
              ]
            }
          ]
        },
        {
          "id": "read",
          "name": "Read",
          "children": [
            {
              "id": "read-get",
              "name": "Read by GET",
              "children": [
                {
                  "id": "test86",
                  "name": "Confirm that the returned HTTP Header Content-Type is present and valid",
                  "description": "Confirm that the returned HTTP Header Content-Type is present and valid",
                  "details": "The correct mime type SHALL be used by clients and servers:\n\nXML: application/fhir+xml\nJSON: application/fhir+json\nRDF: application/fhir+turtle (only the Turtle format is supported)\n\n3.1.0.1.9 Content Types and encodings \nhttps://www.hl7.org/fhir/R4/http.html#mime-type",
                  "actions": [
                    "doSuccessfulReadResponse",
                    "isGetContentTypeOK"
                  ]
                },
                {
                  "id": "test87",
                  "name": "Response resource ID matches input ID",
                  "description": "Response resource ID matches input ID",
                  "details": "The returned resource SHALL have an id element with a value that is the [id]\n\n3.1.0.2 read \nhttps://hl7.org/fhir/R4/http.html#read",
                  "actions": [
                    "doSuccessfulReadResponse",
                    "isReadId"
                  ]
                }
              ]
            }
          ]
        }
      ]
    }
  ]
}